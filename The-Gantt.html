<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Resource Histogram</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="gantt.css" />
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://apis.google.com/js/api.js"></script>
        <script src="https://docs.dhtmlx.com/gantt/codebase/dhtmlxgantt.js?v=6.0.0"></script>
        <script src="https://export.dhtmlx.com/gantt/api.js?v=20180322"></script>


        <style>
            html,
            body {
                margin: 0;
                padding: 0;
                height: 100%;
                overflow: hidden;
                zoom: 94%;
            }
            #gantt_marker_area {
                height: 0px;
            }

            #gantt_container {
                height: 88%; /* Adjust the height to make space for the legend */
                width: 100%;
            }


            .gantt_task_content {
              font-size: 12px;
              color: #fff;
              width: 75%;
              top: 0;
              cursor: pointer;
              position: absolute;
              white-space: nowrap;
              text-align: right;
              text-overflow: initial;
              padding-left: 19px;
          }
            #gantt_here {
                height: 95%;
                width: 100%;
            }
            .gantt_task {
                width: 2000px;
            }
            .weekend {
                background: rgb(224, 223, 223) !important;
            }

            .gantt_task_line {
                border-radius: 5px;
                width: 150px !important;
            }

            .gantt_layout_cell {
                cursor: auto;
                /* Add any other desired styles for the draggable element */
            }

            .gantt_tree_icon {
                display: none;
            }

            /* Update legend container positioning */
            #legend {
                position: absolute;
                bottom: 20px;
                left: 20px;
                width: 200px; /* Set a fixed width for the legend */
            }
            .legend-item {
                display: flex; /* Display legend items in a row */
                align-items: center; /* Align items vertically within each row */
                margin-bottom: 5px; /* Adjust spacing between rows */
            }
            .legend-color {
                width: 16px;
                height: 16px;
                display: inline-block;
                vertical-align: middle;
            }
            .legend-text {
                display: inline-block;
                margin-left: 5px;
                font-family: Arial, Helvetica, sans-serif;
            }

            .gantt_marker {
                position: absolute;
            }

            .gantt_marker_content {
                width: 16px;
                border: 2px solid red;

            }

          /* Override the top positioning to keep the message area visible */
          .gantt_message_area {
            top: 5px !important;
            display: block !important;
            background-color: white !important;
            opacity: 10000000 !important;

            visibility: visible !important;
          }

          .gantt-error {
            background-color: white !important;
            background-color: white !important;
            }
          .hide{
            display: none;
          }

          .gantt-error div {
            background-color: white !important;
          color: #000;
        border-color: #fff;
        }


            /* CSS stylesheet */
            .normal-style1 {
                top: 2px;

                height: 30px !important;
                background-color: grey;
            }
            .normal-style2 {
                top: 37px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style3 {
                top: 72px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style4 {
                top: 107px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style5 {
                top: 142px;

                height: 30px !important;
                background-color: grey;

            }
            .normal-style6 {
                top: 177px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style7 {
                top: 212px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style8 {
                top: 247px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style9 {
                top: 282px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style10 {
                top: 317px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style11 {
                top: 352px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style12 {
                top: 387px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style13 {
                top: 422px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style14 {
                top: 457px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style15 {
                top: 492px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style16 {
                top: 527px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style17 {
                top: 562px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style18 {
                top: 597px;
                background-color: grey;

                height: 30px !important;
            }
            .normal-style19 {
                top: 632px;
                background-color: grey;

                height: 30px !important;
            }



            button{
              border-radius: 5px;
              border: 1px solid grey;
              padding: 5px;
              margin-right: 4px;

                      }

.buttonContainer{
  padding-left: 8px;
  padding-top: 3px;
  padding-bottom: 3px;

}




          #menu svg {
            width: 30px;
    height: 27px;
            }

            #menu {
              height: 25px;
              position: absolute;
              top: 4px;
              border: black 1px solid;
              right: 36px;
              width: auto;
            }


            .nwdiv {
              display: none;
              height: 9%;
              position: relative;
              width: 99%;
              }



    
      
      #contin {
    height: 348px;
        margin: 0px;
        /* margin-left: 0px; */
        padding: 0;      }
      
    
      </style>

    </head>
    <body>
        <div id="buttonContainer" class="buttonContainer">
          <button id="showall">All</button>

            <button id="HRS">Hours View</button>
            <button id="DY">Day View</button>
            <button id="WK">Week View</button>
            <button id="MTH">Month View</button>
            <button id="gotoTodayBtn">Go to Today</button>


        </div>

      	<script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script>
    $(document).ready(function() {
      $(".notification_icon svg").click(function() {
          $(".dropdown").toggleClass("active");
          $(".nwdiv").css("display", "block");
      });
  });
  
	</script>
</head>
<body>

		<div class="notification_icon">
      <svg  viewBox="-2.88 -2.88 29.76 29.76" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff" stroke-width="0.00024000000000000003"><g id="SVGRepo_bgCarrier" stroke-width="0" transform="translate(3.4800000000000004,3.4800000000000004), scale(0.71)"><rect x="-2.88" y="-2.88" width="29.76" height="29.76" rx="14.88" fill="white" strokewidth="0"></rect></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="0.048"></g><g id="SVGRepo_iconCarrier"><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-.696-3.534c.63 0 1.332-.288 2.196-1.458l.911-1.22a.334.334 0 0 0-.074-.472.38.38 0 0 0-.505.06l-1.475 1.679a.241.241 0 0 1-.279.061.211.211 0 0 1-.12-.244l1.858-7.446a.499.499 0 0 0-.575-.613l-3.35.613a.35.35 0 0 0-.276.258l-.086.334a.25.25 0 0 0 .243.312h1.73l-1.476 5.922c-.054.234-.144.63-.144.918 0 .666.396 1.296 1.422 1.296zm1.83-10.536c.702 0 1.242-.414 1.386-1.044.036-.144.054-.306.054-.414 0-.504-.396-.972-1.134-.972-.702 0-1.242.414-1.386 1.044a1.868 1.868 0 0 0-.054.414c0 .504.396.972 1.134.972z" fill="#000000"></path></g></svg>    </div>
		<div   class=" contin dropdown">
  <div class="scrollbar" id="style-1">
    <div class="force-overflow">
      <ul id="contin">
      </ul>

    </div>
  </div>

	</div>
</div>

<style>
  @import url('https://fonts.googleapis.com/css?family=Montserrat&display=swap');

  .scrollbar
  {

    width: 101%;
    float: left;
    height: 251px;
    background: #F5F5F5;
    overflow-y: scroll;
  }

  .force-overflow
{
	min-height: max-content;
}
  
#style-1::-webkit-scrollbar-track
{
	-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
	border-radius: 10px;
	background-color: #F5F5F5;
}

#style-1::-webkit-scrollbar
{
	width: 12px;
	background-color: #F5F5F5;
}

#style-1::-webkit-scrollbar-thumb
{
	border-radius: 10px;
	-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
	background-color:lightgray;
}





 .notification_icon{
  position: absolute;
  width: 50px;
  height: 50px;
  font-size: 25px;
  /* margin: 0 auto; */
  right: 10px;
  text-align: center;
  color: #ADABAB;
  top: 1px;

}

 .notification_icon svg{
cursor: pointer;
width: 27px;

}

 .dropdown{
 width: 645px;
 height: 250px;
 background-color : whitesmoke;
  border-radius: 5px;
  box-shadow: 2px 2px 3px rgba(0,0,0,0.125);
  margin: 15px auto 0;
  position: absolute;
  padding: 11px;

  z-index: 2000;
  /* right: 68px; */
  left: 1051px;
  display: none;
}

 .dropdown .notify_item{
display: flex;
align-items: center;
padding: 10px 0;
border-bottom: 1px solid #dbdaff;
}

 .dropdown .notify_item:last-child{
border-bottom: 0px;
}

 .dropdown .notify_item .notify_img{
margin-right: 15px;
}

 .dropdown .notify_item .notify_info p{
margin-bottom: 5px;
}

 .dropdown .notify_item .notify_info p span{
color: #605dff;
margin-left: 5px;
}

 .dropdown .notify_item .notify_info .notify_time{
color: #c5c5e6;
font-size: 12px;
}

 .dropdown:before{
content: "";
position: absolute;
top: -30px;
left: 96.5%;
transform: translateX(-50%);
border: 15px solid;
border-color: transparent transparent #fff transparent;
}

 .dropdown.active{
display: block;
}
</style>

        <script>

        </script>

        <div id="gantt_container"><div id="gantt_here"></div></div>

        <div id="legend" class="legend"></div>



        <script>














                            var today = new Date();

                          gantt.attachEvent("onGanttRender", function () {
                            var today = new Date();
                            gantt.showDate(today);
                                return true;
                          });


                            gantt.scrollTo(today, true);
                            gantt.templates.scale_cell_class = function(date) {
                              var month = date.getMonth(); // Get the month index (0-11)
                              var colors = ['#000000', '#171717', '#2E2E2E', '#454545', '#5C5C5C', '#737373', '#8A8A8A', '#A1A1A1', '#B8B8B8', '#CFCFCF', '#E6E6E6', '#FFFFFF'];
                              // Example colors for each month

                              // CSS class name for the month cell
                              var monthsToHighlight = [0,2,4,6,8,10]; // Specify the months to highlight (0-11, where 0 is January)

                              var monthtoignore=[1,3,5,7,9,11]


                              if (monthtoignore.includes(month)) {
                                return "ignore-month month_" + month;
                              }

                              if (monthsToHighlight.includes(month)) {
                                return "highlighted-month month_" + month;
                              }

                              return "month_" + month;
                            };

                            // CSS styles for each month cell
                            var styles = `
                            .month_0 { background-color: #CFCFCF; color: #000000; } /* March */
                            .month_1{ background-color: #454545; color: #FFFFFF; } /* April */
                            .month_2 { background-color: #CFCFCF; color: #000000; } /* March */
                            .month_3{ background-color: #454545; color: #FFFFFF; } /* April */
                            .month_4 { background-color: #CFCFCF; color: #000000; } /* March */
                            .month_5{ background-color: #454545; color: #FFFFFF; } /* April */
                            .month_6 { background-color: #CFCFCF; color: #000000; } /* March */
                            .month_7{ background-color: #454545; color: #FFFFFF; } /* April */
                            .month_8 { background-color: #CFCFCF; color: #000000; } /* March */
                            .month_9{ background-color: #454545; color: #FFFFFF; } /* April */
                            .month_10 { background-color: #CFCFCF; color: #000000; } /* March */
                            .month_11{ background-color: #454545; color: #FFFFFF; } /* April */
                            `;

                            var styleTag = document.createElement('style');
                            styleTag.innerHTML = styles;
                            document.head.appendChild(styleTag);





                            gantt.plugins({
                              marker: true
                              });





                             // Handle the button click event
                             document.getElementById("gotoTodayBtn").addEventListener("click", function () {

                              // Navigate the Gantt chart to today
                              gantt.showDate(today);
                               });


                           var dateToStr = gantt.date.date_to_str(gantt.config.task_date);
                           var markerId = gantt.addMarker({
                            start_date: new Date(), //a Date object that sets the marker's date
                            css: "today", //a CSS class applied to the marker
                            text: "", //the marker title
                            title: dateToStr( new Date()) // the marker's tooltip
                            });

                            gantt.config.date_format = "%Y-%m-%d";

  /*

                            // Set the initial date range
                            var startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());  // Set start date to today at midnight
                            startDate.setDate(startDate.getDate() - 7); // Subtract 7 days from the start date
                            var endOfYearDate = new Date(startDate.getFullYear(), 11, 31, 23, 59, 59);  // Set end of year date

                            gantt.config.start_date = gantt.date.date_to_str(gantt.config.date_format)(startDate);
                            gantt.config.end_date = gantt.date.date_to_str(gantt.config.date_format)(endOfYearDate);


                            */


                          // CSS




                        // Attach the toggleHoursView function to the button click event



                            // Load the Google Sheets API
                            gapi.load('client', initGoogleSheetsAPI);

                            function initGoogleSheetsAPI() {
                              gapi.client.init({
                                apiKey: 'AIzaSyC1YBfz6znLEessxTPGSZjIJtM1CRAPZ24',
                                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
                              }).then(fetchData).catch(function(error) {
                                console.log('Error initializing Google Sheets API: ' + error.details);
                              });
                            }


                            function CD(keyword, range) {
                              // Fetch data using Google Sheets API
                              return gapi.client.sheets.spreadsheets.values.get({
                                spreadsheetId: '18II8U7NlNHaplovTFgzuqInZ7hgILgeCdJSkCHU9JVQ',
                                range: range,
                              }).then(response => {
                                var data = response.result.values;

                                var result = [];

                                for (var row = 0; row < data.length; row++) {
                                  for (var col = 0; col < data[row].length; col++) {
                                    var cellValue = data[row][col].toString();
                                    if (cellValue.toLowerCase().indexOf(keyword.toLowerCase()) !== -1) {
                                      var rowResult = {
                                        row: row + 1,
                                        values: [],
                                        HO: [],
                                      };

                                      rowResult.startDate = formatDate(data[row][1]); // Assuming the start date is in the second column (index 1)

                                      var employeeEndIndex = -1;
                                      for (var j = data[row].length - 1; j >= 2; j--) {
                                        if (!isNaN(parseFloat(data[row][j]))) {
                                          employeeEndIndex = j;
                                          break; // Break the loop after finding the last numeric occurrence
                                        }
                                      }

                                      // Modified loop to access all numeric values and non-numeric values
                                      for (var j = 2; j <= employeeEndIndex; j++) {
                                        if (!isNaN(parseFloat(data[row][j]))) {
                                          rowResult.values.push(Number(data[row][j])); // Convert to number before pushing
                                        } else {
                                          rowResult.HO.push(data[row][j]);
                                        }
                                      }     console.log ( rowResult.values)


                                      if (employeeEndIndex > 1) {
                                        rowResult.endDate = formatDate(data[row][employeeEndIndex]);
                                      } else {
                                        rowResult.endDate = "No numeric value found";
                                      }

                                      result.push(rowResult);
                                    }
                                  }
                                }

                                return result;
                              }).catch(error => {
                                console.log('Error fetching data from Google Sheets: ' + error.details);
                                return []; // Return an empty array in case of an error
                              });
                            }


                            var markers = []
                            var bgcolor = []
                            var Ptasks = []


                            function fetchData() {
                              gantt.config.columns = [
                                { name: "text", label: "Operative 1", tree: true, width: 200 },
                              ];

                              gantt.templates.quick_info_class = function(start, end, task){
                                if(task.id == "12")
                                  return "updColor";
                                return "";
                              };
                              gantt.config.scales = [
                            {unit:"day", step:1, date: " %M"},
                            {unit:"day", step:1, date:"%d %D" }
                               ];

                              var daysStyle = function(date) {
                                var dateToStr = gantt.date.date_to_str("%D");
                                if (dateToStr(date) == "Sun" || dateToStr(date) == "Sat")
                                  return "weekend";
                                return "";
                              };

                                    /*

                             // gantt.config.date_scale = "%d %M";
                              gantt.templates.task_text = function(start, end, task) {
                                var progress = Math.round(task.progress * 100); // Calculate the progress percentage
                                return task.text + ' <span style="color: ' + task.progressTextStyle + '">'  + progress + '%</span>';
                              };

                              gantt.templates.tooltip_text = function(start, end, task) {
                                // Customize the tooltip content based on the task data
                                var tooltip = task.progress*100 + " %"

                                return tooltip;
                              };

                              gantt.plugins({
                                tooltip: true
                            });

*/

                              gapi.client.sheets.spreadsheets.values.get({
                                spreadsheetId: '1BQyLzI0v6RwX1cZ_u-nsli9KPIgJNFCH62t3kMeJuhA',
                                range: 'Employees Report!A1:K'
                              }).then(function(response) {
                                var values = response.result.values;
                                var tasks = { data: [] };
                                var projects = {};
                                var taskColors = {}; // Object to store task colors

                                if (values && values.length > 1) {
                                  for (var i = 1; i < values.length; i++) {
                                    var row = values[i];
                                    var startDate = row[1];
                                    var projectName = row[0];
                                    var dueDate= row[6];
                                    var progressValue = parseInt(row[7]);
                                    var taskId = extractTaskId(row[4]);
                                    var taskColor = taskColors[taskId];

                                     if (!taskColor) {

                                      taskColor = generateUniqueColor(taskId);

                                      if(taskId === "2385")
                                      {
                                        taskColor = "#9BA940"
                                      }
                                      else
                                      {
                                        taskColors[taskId] = taskColor;
                                      }

                                      }


                                    var task = {
                                      id: i,
                                      text: row[5],
                                      Ptask: row[4],
                                      start_date: startDate ? new Date(startDate) : null,
                                      duration: parseInt(row[3]),
                                      due_date: dueDate ? new Date(dueDate) : null,
                                      resource: [row[10], row[11], row[12]],
                                      project: projectName,
                                      progress: progressValue / 100,
                                      color: (row[4] === Ptasks[2]) ? "#B67CB9" : (row[4] === Ptasks[0]) ? "#34A09E" : (row[4] === Ptasks[1]) ? "#2E5BAC" : taskColor, // Default to black if taskColor is not set
                                      progressColor: "grey",
                                      progressTextStyle: "color: black"
                                    };






                                                                      // Attach the event handler
                                      gantt.attachEvent("onTaskClick", function(id, e) {
                                          // Get the task by ID
                                          var task = gantt.getTask(id);




                                          // Check if the task has a parent task
                                          if (task && task.Ptask) {
                                              // Get the parent task ID
                                              var parentTaskId = task.Ptask;

                                              // Iterate through all tasks
                                              gantt.eachTask(function(existingTask) {
                                                  // Check if the task has the same parent task
                                                  if (existingTask.Ptask === parentTaskId) {
                                                      // Do nothing, keep the task with the same parent
                                                  } else {
                                                      // Delete tasks with a different parent
                                                      if (!isNaN(existingTask.id)) {
                                                        gantt.deleteTask(existingTask.id);
                                                        markers.forEach(function(marker) {
                                                          if(marker.project === parentTaskId)
                                                          gantt.addMarker(marker);
                                                      });
                                                      }
                                                  }
                                              });
                                          }
                                        });



                                        if (task.due_date) {
                                          // Check if the task has a due date
                                          var markerId = task.id; // Unique marker ID (you can customize it)
                                          var markerStartDate = task.due_date;

                                          if (!Ptasks.includes(task.Ptask)) {
                                            Ptasks.push(task.Ptask);
                                          }

                                          // Create the style element
                                            var styleElement = document.createElement('style');

                                            // Add CSS rules to the style element
                                            styleElement.innerHTML = `
                                              .my-text${i}{
                                                background-color: ${task.color};
                                              }
                                            `;



                                            // Append the style element to the document's head to apply the CSS rules
                                            document.head.appendChild(styleElement);

                                            // Initialize style variable
                                            var style = '';

                                             var mar = "my-text" + i;
                                            if(task.project === "Alexander S"){
                                              style = 'normal-style1 ' + mar
                                            } if(task.project === "Amal"){
                                               style = 'normal-style2 '+mar
                                             } else if(task.project === "Amro H"){
                                               style = 'normal-style3 '+ mar
                                             }  else if(task.project === "B-team AH"){
                                               style = 'normal-style4 '+ mar
                                             }  else if(task.project === "B-team KM"){
                                               style = 'normal-style5 '+ mar
                                             }  else if(task.project === "Fouad D"){
                                               style = 'normal-style6 '+ mar
                                             }  else if(task.project === "Gabriel G"){
                                               style = 'normal-style7 '+ mar
                                             }  else if(task.project === "Khaled M"){
                                               style = 'normal-style8 '+ mar
                                             }  else if(task.project === "Kostadin R"){
                                               style = 'normal-style9 '+ mar
                                             } else if(task.project === "Manu V"){
                                               style = 'normal-style10 '+ mar
                                             }  else if(task.project === "Mayar N"){
                                               style = 'normal-style11 '+ mar
                                             }  else if(task.project === "Nada"){
                                               style = 'normal-style13 '+ mar
                                             } else if(task.project === "Rehaf H"){
                                               style = 'normal-style14 '+ mar
                                             }  else if(task.project === "Shaimaa M"){
                                               style = 'normal-style15 '+ mar
                                             }  else if(task.project === "Stanley P"){
                                               style = 'normal-style16 '+ mar
                                             }  else if(task.project === "Todor T"){
                                               style = 'normal-style17 '+ mar
                                             }  else if(task.project === "Valeria D"){
                                               style = 'normal-style18 '+ mar
                                             } else if(task.project === "Veselina M"){
                                               style = 'normal-style19 '+ mar
                                             } else if(task.project === "Mina Tarek"){
                                               style = 'normal-style12 ' + mar
                                             }


                                            // Set the custom property for the primary color if currentPtask is truthy

                                            var tasklab = task.text;
                                            var numbers = tasklab.match(/\d+/g); // Extract numbers from the task name
                                            var taskl = numbers ? numbers[0] + "." + numbers[1] : "";

                                            // Create the marker
                                            var marker = {
                                              id: markerId,
                                              start_date: markerStartDate,
                                              css: style,
                                              text: taskl,
                                              project: task.Ptask
                                            };



                                            markers.push(marker);

                                        }




                                    // Check if the project already exists in the projects object
                                    if (projects.hasOwnProperty(projectName)) {
                                      // Check if the subtask already exists in the project's subtasks object
                                      if (projects[projectName].subtasks.hasOwnProperty(row[4])) {
                                        // Add the subtask as a subtask under the project's subtask
                                       // task.color = projects[projectName].subtasks[row[4]].color; // Assign the same color as the parent subtask
                                        gantt.addTask(task, projects[projectName].subtasks[row[4]].id);
                                      } else {
                                        // Create a new subtask and add it to the project's subtasks object
                                        var subtask = {
                                          id: "p_" + i + "_" + row[4], // Prefix "p_" to distinguish subtasks from regular tasks
                                          text: row[4],
                                          start_date: task.start_date,
                                          resource: task.resource,
                                          project: projectName, // Store project name as a property in the subtask
                                          progress: task.progress,
                                          color:task.color
                                        };

                                        gantt.addTask(subtask, projects[projectName].id);
                                        projects[projectName].subtasks[row[4]] = subtask; // Store the subtask in the project's subtasks object
                                      }
                                    } else {
                                      // Create a new project task and add it to the tasks array
                                      var projectTask = {
                                        id: "p_" + i, // Prefix "p_" to distinguish project tasks from regular tasks
                                        text: projectName,
                                        start_date: null,
                                        progress: 0,
                                        open: true,
                                        render: "split",
                                        subtasks: {} // Object to store subtasks by their name
                                      };
                                      gantt.addTask(projectTask);
                                      projects[projectName] = projectTask; // Store the project task in the projects object

                                      // Create a new subtask for the project and add it to the project's subtasks object
                                      var subtask = {
                                        id: "p_" + i + "_" + row[4], // Prefix "p_" to distinguish subtasks from regular tasks
                                        text: row[4],
                                        start_date: task.start_date,
                                        resource: task.resource,
                                        project: projectName, // Store project name as a property in the subtask
                                        progress: task.progress,
                                        color:task.color
                                      };
                                      gantt.addTask(subtask, projects[projectName].id);
                                      projects[projectName].subtasks[row[4]] = subtask; // Store the subtask in the project's subtasks object*/
                                    }
                                  }
                                }


                                // Sort the projects alphabetically
                                var sortedProjects = Object.keys(projects).sort();
                                var sortedTasks = [];


                                // Build the sorted tasks array based on the sorted projects and subtasks
                                sortedProjects.forEach(function(projectName, index) {
                                  var projectTask = projects[projectName];
                                  projectTask.sortorder = index; // Assign a sortorder property to maintain the alphabetical order
                                  sortedTasks.push(projectTask);

                                  // Get the subtasks of the project and add them to the sorted tasks array
                                  var sortedSubtasks = Object.values(projectTask.subtasks).sort(function(a, b) {
                                    return a.text.localeCompare(b.text); // Sort subtasks alphabetically by their text
                                  });
                                  sortedSubtasks.forEach(function(subtask) {
                                    subtask.sortorder = index; // Assign the same sortorder as the parent project
                                    sortedTasks.push(subtask);
                                  });
                                });




                                var monthViewBtn = document.getElementById("MTH");
                                monthViewBtn.addEventListener("click", function() {
                                gantt.config.skip_off_time = false;    // hides non-working time in the chart

                                  gantt.config.scale_unit = "month";
                                  gantt.config.date_scale = "%F, %Y";
                                  gantt.templates.scale_cell_class = function(date) {
                                    var month = date.getMonth(); // Get the month index (0-11)
                                    var colors = ['#B8B8B8', '#CFCFCF', '#E6E6E6', '#FFFFFF', '#B8B8B8', '#CFCFCF', '#E6E6E6', '#FFFFFF', '#B8B8B8', '#CFCFCF', '#E6E6E6', '#FFFFFF'];
                                    // Example colors for each month

                                    // CSS class name for the month cell
                                    var monthsToHighlight = [0,2,4,6,8,10]; // Specify the months to highlight (0-11, where 0 is January)

                                    var monthtoignore=[1,3,5,7,9,11]


                                    if (monthtoignore.includes(month)) {
                                      return "ignore-month month_" + month;
                                    }



                                    if (monthsToHighlight.includes(month)) {
                                      return "highlighted-month month_" + month;
                                    }

                                    return "month_" + month;
                                  };
                                  gantt.config.subscales=null;

                                  // CSS styles for each month cell
                                  var styles = `
                                  .month_0 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_1{ background-color: #454545; color: #FFFFFF; } /* April */
                                  .month_2 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_3{ background-color: #454545; color: #FFFFFF; } /* April */
                                  .month_4 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_5{ background-color: #454545; color: #FFFFFF; } /* April */
                                  .month_6 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_7{ background-color: #454545; color: #FFFFFF; } /* April */
                                  .month_8 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_9{ background-color: #454545; color: #FFFFFF; } /* April */
                                  .month_10 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_11{ background-color: #454545; color: #FFFFFF; } /* April */
                                  `;

                                  var styleTag = document.createElement('style');
                                  styleTag.innerHTML = styles;
                                  document.head.appendChild(styleTag);

                                  gantt.render();
                                });

                                var weekViewBtn = document.getElementById("WK");
                               weekViewBtn.addEventListener("click", function() {
                                gantt.config.skip_off_time = false;    // hides non-working time in the chart

                                  gantt.config.scale_unit = "week";
                                  gantt.config.date_scale = "%j %M";
                                  gantt.templates.scale_cell_class = function(date) {
                                    var month = date.getMonth(); // Get the month index (0-11)
                                    var colors = ['#000000', '#171717', '#2E2E2E', '#454545', '#5C5C5C', '#737373', '#8A8A8A', '#A1A1A1', '#B8B8B8', '#CFCFCF', '#E6E6E6', '#FFFFFF'];
                                    // Example colors for each month

                                    // CSS class name for the month cell
                                    var monthsToHighlight = [0,2,4,6,8,10]; // Specify the months to highlight (0-11, where 0 is January)

                                    if (monthsToHighlight.includes(month)) {
                                      return "highlighted-month month_" + month;
                                    }
                                    var monthtoignore=[1,3,5,7,9,11]


                                    if (monthtoignore.includes(month)) {
                                      return "ignore-month month_" + month;
                                    }




                                    return "month_" + month;
                                  };


                                  gantt.config.subscales=null;


                                  // CSS styles for each month cell
                                  var styles = `
                                  .month_0 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_1{ background-color: #454545; color: #FFFFFF; } /* April */
                                  .month_2 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_3{ background-color: #454545; color: #FFFFFF; } /* April */
                                  .month_4 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_5{ background-color: #454545; color: #FFFFFF; } /* April */
                                  .month_6 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_7{ background-color: #454545; color: #FFFFFF; } /* April */
                                  .month_8 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_9{ background-color: #454545; color: #FFFFFF; } /* April */
                                  .month_10 { background-color: #CFCFCF; color: #000000; } /* March */
                                  .month_11{ background-color: #454545; color: #FFFFFF; } /* April */
                                  `;

                                  var styleTag = document.createElement('style');
                                  styleTag.innerHTML = styles;
                                  document.head.appendChild(styleTag);

                                  gantt.render();
                                });

                               var dayViewBtn = document.getElementById("DY");
                               dayViewBtn.addEventListener("click", function() {
                                gantt.config.skip_off_time = false;    // hides non-working time in the chart

                                gantt.config.scale_unit = "day";
                                gantt.config.date_scale = "%M";
                                gantt.config.subscales = [
                                    { unit: "day", date: "%d %D" }
                                ];
                                    gantt.templates.scale_cell_class = function(date) {
                                      var month = date.getMonth(); // Get the month index (0-11)
                                      var colors = ['#000000', '#171717', '#2E2E2E', '#454545', '#5C5C5C', '#737373', '#8A8A8A', '#A1A1A1', '#B8B8B8', '#CFCFCF', '#E6E6E6', '#FFFFFF'];
                                      // Example colors for each month

                                      // CSS class name for the month cell
                                      var monthsToHighlight = [0,2,4,6,8,10]; // Specify the months to highlight (0-11, where 0 is January)

                                      if (monthsToHighlight.includes(month)) {
                                        return "highlighted-month month_" + month;
                                      }
                                      var monthtoignore=[1,3,5,7,9,11]


                                      if (monthtoignore.includes(month)) {
                                        return "ignore-month month_" + month;
                                      }




                                      return "month_" + month;
                                    };




                                    // CSS styles for each month cell
                                    var styles = `
                                    .month_0 { background-color: #CFCFCF; color: #000000; } /* March */
                                    .month_1{ background-color: #454545; color: #FFFFFF; } /* April */
                                    .month_2 { background-color: #CFCFCF; color: #000000; } /* March */
                                    .month_3{ background-color: #454545; color: #FFFFFF; } /* April */
                                    .month_4 { background-color: #CFCFCF; color: #000000; } /* March */
                                    .month_5{ background-color: #454545; color: #FFFFFF; } /* April */
                                    .month_6 { background-color: #CFCFCF; color: #000000; } /* March */
                                    .month_7{ background-color: #454545; color: #FFFFFF; } /* April */
                                    .month_8 { background-color: #CFCFCF; color: #000000; } /* March */
                                    .month_9{ background-color: #454545; color: #FFFFFF; } /* April */
                                    .month_10 { background-color: #CFCFCF; color: #000000; } /* March */
                                    .month_11{ background-color: #454545; color: #FFFFFF; } /* April */
                                    `;

                                    var styleTag = document.createElement('style');
                                    styleTag.innerHTML = styles;
                                    document.head.appendChild(styleTag);

                                    gantt.render();
                                  });



                              // Create the "Hrs View" button
                              var HrsViewBtn = document.getElementById("HRS");

                              // Add a click event listener to the button
                              HrsViewBtn.addEventListener("click", function() {

                                // Change the Gantt chart configuration
                                gantt.config.scale_unit = "hour"; // Use "hour" instead of "Hours"
                                gantt.config.date_scale = "%d %D"; // Display hour and minutes
                                gantt.config.subscales = [
                                  { unit: "hour", step: 1, date: "%H:%i" } // Display hours and minutes in subscale
                                ];


                              gantt.config.work_time = true;  // removes non-working time from calculations
                             // gantt.config.skip_off_time = true;    // hides non-working time in the chart
                              gantt.setWorkTime({ hours:["9:00-18:00"] });


                                  gantt.render();
                                });




                                var legendContainer = document.getElementById("legend");
                                while (legendContainer.firstChild) {
                                  legendContainer.removeChild(legendContainer.firstChild);
                                }
                                var addedTasks = []; // Keep track of added tasks

                                sortedTasks.forEach(function (task) {
                                  // Check if the task has already been added to the legend or has no color
                                  if (addedTasks.includes(task.text) || !task.color) {
                                    // Remove all existing legend items if the task has already been added

                                    return; // Exit the loop if the task has already been added
                                  } else {
                                    // Create a new legend item
                                    var legendItem = document.createElement("div");
                                    legendItem.classList.add("legend-item");

                                    // Create a div for the legend color
                                    var legendColor = document.createElement("div");
                                    legendColor.classList.add("legend-color");
                                    legendColor.style.backgroundColor = task.color;

                                    // Create a div for the legend text and set its content
                                    var legendText = document.createElement("div");
                                    legendText.classList.add("legend-text");
                                    legendText.textContent = task.text;

                                    // Add the task text to the list of added tasks
                                    addedTasks.push(task.text);

                                    // Append color and text elements to the legend item
                                    legendItem.appendChild(legendColor);
                                    legendItem.appendChild(legendText);

                                    // Append the legend item to the legend container
                                    legendContainer.appendChild(legendItem);

                                    // Log the task text to the console
                                    console.log(task.text);
                                  }
                                });




                                gantt.init("gantt_here");
                                gantt.parse({ data: sortedTasks });




                                gantt.eachTask(function(task) {
                                  if (task.progress < 100 && task.due_date <= task.end_date) {
                                    task.color ="red"
                                      var newDiv =  document.createElement('li');

                                      // Adding styles to the new div
                                      newDiv.style.cursor = "pointer"
                                      newDiv.style.color = '#909399';

                                      newDiv.classList.add("nwdiv")
                                      newDiv.id = ("all")
                                      newDiv.style.backgroundColor = '#edf2fc';
                                      newDiv.style.top = (document.querySelectorAll('#contin li').length * 15) + 'px';
                                      newDiv.style.borderRadius = '5px';



                                      // Creating an inner div
                                      var innerDiv = document.createElement('div');

                                      // Creating an image element for the info icon
                                      var infoIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                                      infoIcon.setAttribute("fill", "#909399");
                                      infoIcon.setAttribute("viewBox", "0 0 1920 1920");
                                      infoIcon.setAttribute("xmlns", "http://www.w3.org/2000/svg");
                                      infoIcon.setAttribute("stroke", "#909399");

                                      var path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                                      path.setAttribute("d", "M960 0c530.193 0 960 429.807 960 960s-429.807 960-960 960S0 1490.193 0 960 429.807 0 960 0Zm223.797 707.147c-28.531-29.561-67.826-39.944-109.227-39.455-55.225.657-114.197 20.664-156.38 40.315-100.942 47.024-178.395 130.295-242.903 219.312-11.616 16.025-17.678 34.946 2.76 49.697 17.428 12.58 29.978 1.324 40.49-9.897l.69-.74c.801-.862 1.591-1.72 2.37-2.565 11.795-12.772 23.194-25.999 34.593-39.237l2.85-3.31 2.851-3.308c34.231-39.687 69.056-78.805 115.144-105.345 27.4-15.778 47.142 8.591 42.912 35.963-2.535 16.413-11.165 31.874-17.2 47.744-21.44 56.363-43.197 112.607-64.862 168.888-23.74 61.7-47.405 123.425-70.426 185.398l-2 5.38-1.998 5.375c-20.31 54.64-40.319 108.872-53.554 165.896-10.575 45.592-24.811 100.906-4.357 145.697 11.781 25.8 36.77 43.532 64.567 47.566 37.912 5.504 78.906 6.133 116.003-2.308 19.216-4.368 38.12-10.07 56.57-17.005 56.646-21.298 108.226-54.146 154.681-92.755 47.26-39.384 88.919-85.972 126.906-134.292 12.21-15.53 27.004-32.703 31.163-52.596 3.908-18.657-12.746-45.302-34.326-34.473-11.395 5.718-19.929 19.867-28.231 29.27-10.42 11.798-21.044 23.423-31.786 34.92-21.488 22.987-43.513 45.463-65.634 67.831-13.54 13.692-30.37 25.263-47.662 33.763-21.59 10.609-38.785-1.157-36.448-25.064 2.144-21.954 7.515-44.145 15.046-64.926 30.306-83.675 61.19-167.135 91.834-250.686 19.157-52.214 38.217-104.461 56.999-156.816 17.554-48.928 32.514-97.463 38.834-149.3 4.357-35.71-4.9-72.647-30.269-98.937Z");

                                      infoIcon.appendChild(path);
                                      infoIcon.style.width = '15px';
                                      infoIcon.style.paddingRight = '10px';
                                      infoIcon.style.paddingLeft = '10px';
                                      infoIcon.style.paddingTop = '5px';
                                      infoIcon.style.paddingBottom = '0px';

                                      // Adding text content to the inner div
                                      innerDiv.appendChild(infoIcon);
                                      var spanElement = document.createElement("span");
                                      spanElement.appendChild(document.createTextNode(task.text + " has passed the completion date with completion percentage of   "+"  " + task.progress * 100));
                                      innerDiv.appendChild(spanElement);
                                      // Creating a div for the close (x) icon
                                      var closeDiv = document.createElement('div');
                                      closeDiv.style.cursor = 'pointer';
                                      closeDiv.style.marginRight = '5px';
                                      closeDiv.style.width = "50px"
                                      closeDiv.style.position = "absolute"
                                      closeDiv.style.left = "555px"
                                      closeDiv.style.top = "6px"
                                      closeDiv.id = "close"
                                      closeDiv.style.textAlign = 'right';

                                      var closeIcon = document.createElement('span');
                                      closeIcon.textContent = 'x';

                                      closeDiv.addEventListener('click', function () {
                                          if (newDiv) {
                                              newDiv.remove();
                                              rearrangeItems();
                                          }
                                      });

                                      closeDiv.appendChild(closeIcon);

                                      innerDiv.appendChild(closeDiv);

                                      newDiv.appendChild(innerDiv);

                                      document.getElementById('contin').appendChild(newDiv);

                                     // Adding an event listener to the 'all' div
                                      all = document.getElementById('all');
                                      all.addEventListener('click', function() {
                                          console.log(task);
                                      });


                                  }



                                  function rearrangeItems() {
                                    var container = document.getElementById('contin');
                                    var divs = container.querySelectorAll('div');
                                    var closeDiv = document.getElementById('close');
                                
                                    // Reposition the remaining items
                                    divs.forEach(function (div, index) {
                                        if (div.id === "close") {
                                            closeDiv.style.top = '6px';
                                        } else {
                                            div.style.top = (index * 5) + 'px';
                                        }
                                    });
                                
                                    // Adjust the height of the dropdown and scrollbar
                                    adjustDropdownHeight();
                                }
                                
                                function adjustDropdownHeight() {
                                    var dropdown = document.querySelector('.dropdown');
                                    var scrollbar = document.querySelector('.scrollbar');
                                
                                    // Set the height of the dropdown based on its content
                                    dropdown.style.height = scrollbar.scrollHeight + 'px';
                                
                                    // Optionally, you can set a maximum height to avoid excessive growth
                                    var maxHeight = 250; // Adjust this value as needed
                                    if (scrollbar.scrollHeight > maxHeight) {
                                        dropdown.style.height = maxHeight + 'px';
                                        scrollbar.style.height = maxHeight - 5 + 'px'; // Adjust for scrollbar width
                                    }
                                }
                                
                      });


                              }).catch(function(error) {
                                console.log('Error fetching data: ' + error.result.error.message);
                              });
                            }
                        





                            function extractTaskId(taskName) {
                              var numbers = taskName.match(/\d+/g); // Extract numbers from the task name
                              if (numbers && numbers.length > 0) {
                                return parseInt(numbers[0]); // Use the first extracted number as the task ID
                              }
                              return null;
                            }

                            function generateUniqueColor(taskId) {
                              var taskIdString = String(taskId);
                              var hash = 0;
                              for (var i = 0; i < taskIdString.length; i++) {
                                hash = (hash << 5) - hash + taskIdString.charCodeAt(i);
                                hash |= 0;
                              }

                              var r = (hash & 0xFF0000) >> 16;
                              var g = (hash & 0x00FF00) >> 8;
                              var b = hash & 0x0000FF;

                              var color = "#" + ((1 << 24) | (r << 16) | (g << 8) | b).toString(16).slice(1);
                              return color;

                            }




          var showBtn = document.getElementById("showall");

          // Adding a click event listener to the button
          showBtn.addEventListener("click", function() {


            markers.forEach(function(marker) {
              if (marker) {
                  gantt.deleteMarker(marker.id);
              }
          });
          console.log(markers)
          fetchData()


          });
/*
          function toggleMenu() {
            var submenu = document.querySelectorAll('.nwdiv');

            submenu.forEach(function(item) {
              item.style.display = (item.style.display === 'block') ? 'none' : 'block';
            });

            var submenu2 = document.getElementById('contin');
          submenu2.style.display = (submenu2.style.display === 'block') ? 'none' : 'block';
        }
*/
       </script>

    

      </body>
</html>
